- 当スクリプトはまだ作成中です。
- READMEは「仕様」ではなく「作りたいもの」が書いてあります。
- ここの記載はコロコロ変わります。
---

![Image](https://github.com/user-attachments/assets/f14fc682-b791-4f64-93d2-f146191d1080)

---

# 目的
- 枯れた技術・簡易な手段で実装し、完成後のメンテナンスコストを低減する。
- 上記を満たす範疇で、可能な限り複数の環境で動作することを目指す。

## ファイル自体の可搬性
- 操作対象は構造化テキストファイル
- ディレクトリによるアウトライン管理ではない
> やはり作品一つをテキストファイル一つに収めることは重要

## アプリ自体の可搬性
- TUIツールにて実現する

## 外部エディタの使用
- nano、vi、などの(普遍的な)エディタに編集機能を肩代わりさせる
- micro、editなどの任意の(ユーザが導入した)エディタも指定可能とする

## 外部ビューワの使用
- 編集したくないときのために、ビューモードも搭載
- less、moreなどのコマンドにビューワ機能を肩代わりさせる
- 何らかの任意のビューワを指定可能とする。

---

# 意図
- 意図する用途は、短い小説の執筆
- ハルナアウトラインが消えてしまい、お気に入りのアウトラインエディタが失われてしまった。
    - もうサ終に怯えたくない
- ハルナアウトラインの代替品を探しても
    - 機能が多すぎるか少なすぎるのでちょうどいいのが欲しい
    - Android携帯とパソコンで動くものが限られるので色んなところで使えるが欲しい
- 世に言うテキストエディターはUIがうるさすぎる
    - Linuxターミナルくらい静かな、Zenっぽいのでいい

## 一旦の答え

### linuxとかのTUIでいいのでは

- UIが静かでよい
- そもそもアウトライン執筆においてエディタ部分にさほど高機能を求めてない
- ターミナルとbashなら色んなとこで動く
    - Android携帯にtermuxをいれて
    - ChromebookのCrostiniをONにして
    - WindowsにWSLをいれて？使ってないから知らん。
    - ラズパイとか？
    > 全部同じUIになる……かも？

### エディタを自分で作る必要なんてないのでは

- MS_EDITや、Microは、編集するのに十分。
- 置換や検索はbashで使えるlinuxコマンドがあればいける。
> これで、実装すべきはツリー形式での表示やノードの操作のみになる！楽！

---

# 機能

## 外部エディタの呼び出し
- edit、microなどターミナルからコマンドラインで呼び出せるもの

## 外部ビューワの呼び出し
- less、moreなどターミナルからコマンドラインで呼び出せるもの

## 機能/実装進捗

- [x] ツリー表示
    - [x] 開始行番号あり
    - [x] 開始・終了行番号、深さなど可能なオプションをすべて表示
- [x] ノードの閲覧
    - [x] 単一ノードの閲覧
    - [x] 配下ノードを含んだ貫通閲覧
- [x] ノードの追加
    - [x] 追加後、即編集
    - [x] 追加時に新ノードの名称を指定(未指定でデフォルト) 
- [x] ノードの編集
- [x] (ある程度)任意の使用エディターの指定
- [x] (ある程度)任意の使用ビューワーの指定
- [x] ノードの削除
    - [x] 単一ノードの削除
    - [x] 配下ノードを含んだ一括削除
- [x] ノードの名称変更→ノードの編集で兼務 
- [x] ノードの移動(上下交換)
    - [x] 単一ノードの削除
    - [x] 配下ノードを含んだ移動(グループ上下交換)
- [x] ノードの深さ変更
    - [x] 単一ノードの深さ変更
    - [x] 配下ノードを含んだ深さ変更(グループ深さ変更)
- [x] フォーカス表示(詳細表示含む)
- [ ] ノードの結合
    - [x] ひとつ下のノードどの結合
    - [ ] 配下ノードを含んだノードの結合
- [ ] ノードの分割→自動化は無理では？
- [x] マーク機能
    - [x] 完了マーク
    - [x] ノードの特性を示すシンボル
- [x] ノードの別ファイル保存
    - [ ] 単一ノードの別ファイル保存→現実的に使わないのでは
    - [x] 配下ノードを含んだ別ファイル保存(ノード情報残/消)
- [ ] 各ノードの先頭行プレビュー→あまり効果がない割に処理が重くなるので廃止
- [ ] ノードごと個別の折り畳み/展開表示
- [x] 空行とタイトル行を除いたコンテンツ部分の文字数表示
    - [x] 単一ノードの文字列をツリーに表示
    - [x] 配下ノードを含んだ文字列を取得するコマンド
    - [x] ツリー表示時に全体の文字数を表示
    - [x] フォーカス表示時に配下ノードを含んだ文字列を表示

---

# 使い方

## インストール
- とくになし。
- Linuxターミナルが使える場所を用意する。
  - chromebookのcrostini
  - Android携帯のtermux
  - とか
- ただのbashスクリプトなので、好きな場所において実行する。

## 実行方法

`$ bash wrigglekick.sh [第1引数] [第2引数] [第3引数] [第4引数]`

- 引数1:対象File
- 引数2:動作指定
    - t.....ツリービュー(省略可)
    - tl....行番号付きツリービュー
    - tla...行番号範囲深さ付きツリービュー
    - f.....フォーカスビュー
    - fl....行番号付きフォーカスビュー
    - fla...行番号範囲深さ付きフォーカスビュー
    - v.....対象ノードの閲覧
    - gv....対象ノードの配下ノードを横断的に閲覧
    - e.....対象ノードの編集
    - d.....対象ノードの削除
    - gd....対象ノードの配下ノードをまとめて削除
    - i.....対象ノードの下に新規ノード挿入。追加引数としてノード名
    - ie....対象ノードの下に新規ノード挿入、即編集モードへ。追加引数としてノード名
    - mu....対象ノードひとつを上へ移動
    - md....対象ノードひとつを下へ移動
    - ml....対象ノードひとつを左へ移動(浅くする)
    - mr....対象ノードひとつを右へ移動(深くする)
    - gmu...自分の配下ノードを引き連れて上へ移動
    - gmd...自分の配下ノードを引き連れて下へ移動
    - gml...自分の配下ノードを引き連れて左へ移動(浅くする)
    - gmr...自分の配下ノードを引き連れて右へ移動(深くする)
    - j.....指定ノードを、下のノードと結合
    - c.....指定ノードの済/未マークを切り替える
    - gc....自分の配下ノードを含んだ文字数を通知する
    - s.....指定ノードに表示シンボルを設定する。追加引数でシンボルを指定(1文字)
    - o.....自分の配下ノードを含んだ範囲を別ファイル出力する。追加引数で出力ファイル名
    - 数字...対象ノードを編集(eと引数3を省略)
- 引数3:動作対象ノード番号
- 引数4:動作指定ごとに必要なオプション

### 例

./tgt.txtのノード情報をツリー表示する

```
$ bash wrigglekick.sh ./tgt.txt t
```

./tgt.txtの2番目のノードを編集する

```
(ツリー表示後、ヒストリーから少し変えて)
$ bash wrigglekick.sh ./tgt.txt e 2
```

# 機能について補足

## 模倣・実装しない機能
- 文章の編集機能(ツリー操作のみ行うツールとする)
- 複数の構造化テキストファイルへの対応
- 葉と枝の区別(全てがタイトルを持った葉とする)
- ディレクトリでのツリー化
- 文字コード、改行コードの判定
- 単一ノードの上下交換では、深さが違っても交換可能とする
- 配下ノードを含む上下移動では、深さが同じもの同士のみを許容する
- ツリー表示での各ノードの冒頭プレビュー

## ファイルフォーマット
- 特に指定しない。
- プレーンテキストで、指定のエディタが許容するもの？
- 改行コードはlf

## ノードについて
- ノードは「タイトル行」と「コンテンツ」からなる
    - タイトル行は先頭1行のみ
    - コンテンツは2行目以降(次のノード開始行の1行前まで)
- タイトル行は、後述の「ノードシンボル」「タイトル」「完了オプション」「シンボル」からなる。
    - タイトル行の要素は、それぞれタブ文字で区切られる

### ノードシンボル
- 行頭「.」はノードタイトル
- 「.」の個数によってツリーの深さを示す。
- 数/深さが多い場合の表示の保証はしない

### タイトル
- 空も許可するが、タブ文字は使用できない。

### オプション
- ノードに対して完了/未完了のマークを設定できる。
- ノードに対して1つのシンボルを設定できる。

### レベル(深さ)判定
- 同じ高さのノードを自動で特別化したりはしない
- レベルは抜いて設定できる(レベル1の下にレベル10のノードが直接ぶら下がれる)

### 順序
- 判定しない。ファイル上の順行に従う。

## 性能
- 1ＭByteのファイルを、5秒以内にオープンできること。
